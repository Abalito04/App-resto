<!DOCTYPE html>
<html lang="es">
<head>

    <meta charset="UTF-8">
    <title>{% if current_restaurante %}{{ current_restaurante.nombre }} - {% endif %}Resto App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#f3b927">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon-192.png') }}">
    <script src="https://kit.fontawesome.com/4c7c8e0e6e.js" crossorigin="anonymous"></script>
    <!-- Cambia solo el bloque <style> en tu base.html -->
<!-- Cambia solo el bloque <style> en tu base.html -->
<style>
  body.bg-dark {
    background-color: #181818 !important;
    color: #f8f9fa !important;
  }
  body.bg-light {
    background-color: #e6f2ed !important; /* Verde pastel muy suave */
    color: #212529 !important;
  }
  .navbar-custom-dark {
    background-color: #23272b !important;
    color: #fff !important;
  }
  .navbar-custom-light {
    background-color: #6ba292 !important; /* Verde pastel navbar */
    color: #fff !important;
    border-bottom: 1px solid #355c7d;
  }
  .navbar-custom-dark .navbar-nav .nav-link,
  .navbar-custom-dark .navbar-brand,
  .navbar-custom-dark .dropdown-toggle,
  .navbar-custom-dark .btn-outline-light {
    color: #fff !important;
  }
  .navbar-custom-light .navbar-nav .nav-link,
  .navbar-custom-light .navbar-brand,
  .navbar-custom-light .dropdown-toggle,
  .navbar-custom-light .btn-outline-dark {
    color: #264653 !important;
  }
  .dropdown-menu.bg-dark {
    background-color: #23272b !important;
  }
  .dropdown-menu.bg-light {
    background-color: #e6f2ed !important; /* Verde pastel muy claro para el menú */
  }
  .dropdown-menu .dropdown-item {
    color: #264653 !important;
  }
  .btn-outline-light, .btn-outline-dark {
    border-color: transparent;
  }
  #toggle-theme {
    min-width: 40px;
  }
  .btn-theme-dark {
    background: #23272b !important;
    color: #fff !important;
    border: 1px solid #fff !important;
  }
  .btn-theme-light {
    background: #6ba292 !important;
    color: #fff !important;
    border: 1px solid #355c7d !important;
  }
  .btn-primary, .btn-primary:active, .btn-primary:focus {
    background-color: #355c7d !important;
    border-color: #355c7d !important;
    color: #fff !important;
  }
  .btn-warning, .btn-warning:active, .btn-warning:focus {
    background-color: #a8dadc !important;
    border-color: #a8dadc !important;
    color: #264653 !important;
  }
  .btn-danger, .btn-danger:active, .btn-danger:focus {
    background-color: #264653 !important;
    border-color: #264653 !important;
    color: #fff !important;
  }
  .badge.bg-info {
    background-color: #6ba292 !important;
    color: #fff !important;
  }
  .form-control:focus {
    border-color: #6ba292 !important;
    box-shadow: 0 0 0 0.2rem rgba(107,162,146,.25) !important;
  }
  .table-striped > tbody > tr:nth-of-type(odd) {
    background-color: #e6f2ed !important;
  }
  .table-striped > tbody > tr:nth-of-type(even) {
    background-color: #fff !important;
  }
</style>
</head>
<body class="bg-light">
<nav id="main-navbar" class="navbar navbar-expand-lg navbar-custom-dark">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="{{ url_for('index_redirect') }}">
      {% if current_restaurante %}{{ current_restaurante.nombre }}{% else %}Resto App{% endif %}
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarMain">
      {% if current_user.is_authenticated %}
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('index_redirect') }}">{{ _('Mozo') }}</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('cocina') }}">{{ _('Cocina') }}</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('historial') }}">{{ _('Historial') }}</a></li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('auth.configuracion') }}">
            <i class="fas fa-cog"></i> {{ _('Configuración') }}
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('auth.planes') }}">
            <i class="fas fa-chart-line"></i> {{ _('Planes') }}
          </a>
        </li>
        {% if current_user.es_superadmin %}
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('auth.admin_usuarios') }}">
            <i class="fas fa-users"></i> {{ _('Panel de Usuarios') }}
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('auth.admin_planes') }}">
            <i class="fas fa-chart-bar"></i> {{ _('Admin Planes') }}
          </a>
        </li>
        {% endif %}
      </ul>
      <span class="badge bg-info me-3">{{ _('Plan') }} {{ current_restaurante.plan|title }}</span>
      <div class="d-flex align-items-center gap-2">
        <span id="pwa-status" class="badge bg-secondary">{{ _('Conectado') }}</span>
        <button id="enable-notifications" class="btn btn-outline-warning btn-sm" style="display:none;">
          <i class="fas fa-bell"></i>
        </button>
        <button id="toggle-theme" class="btn btn-theme-dark btn-sm" title="{{ _('Cambiar tema') }}">
          <i class="fas fa-moon"></i>
        </button>
        <div class="dropdown">
          <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown" title="{{ _('Cambiar idioma') }}">
            <i class="fas fa-globe"></i> {{ _('Idioma') }}
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            {% for code, name in languages.items() %}
            <li>
              <a class="dropdown-item {% if get_locale() == code %}active{% endif %}" href="{{ url_for('set_language', language=code) }}">
                {{ name }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        <div class="dropdown">
          <button class="btn btn-outline-light dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
            <i class="fas fa-user"></i> {{ current_user.nombre }}
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{{ url_for('auth.perfil') }}">{{ _('Mi Perfil') }}</a></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.configuracion') }}">{{ _('Configuración') }}</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">{{ _('Cerrar Sesión') }}</a></li>
          </ul>
        </div>
      </div>
      {% else %}
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <div class="dropdown">
            <button class="btn btn-outline-light dropdown-toggle me-2" type="button" data-bs-toggle="dropdown" title="{{ _('Cambiar idioma') }}">
              <i class="fas fa-globe"></i> {{ _('Idioma') }}
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              {% for code, name in languages.items() %}
              <li>
                <a class="dropdown-item {% if get_locale() == code %}active{% endif %}" href="{{ url_for('set_language', language=code) }}">
                  {{ name }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>
        </li>
        <li class="nav-item"><a href="{{ url_for('auth.login') }}" class="btn btn-outline-light me-2">{{ _('Iniciar Sesión') }}</a></li>
        <li class="nav-item"><a href="{{ url_for('auth.registro') }}" class="btn btn-light">{{ _('Registrarse') }}</a></li>
      </ul>
      {% endif %}
    </div>
  </div>
</nav>
<main id="main-content" class="container my-3">
  {% block content %}{% endblock %}
</main>
<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Tema oscuro/claro
function setTheme(dark) {
    document.body.classList.toggle('bg-dark', dark);
    document.body.classList.toggle('text-white', dark);

    // Main content
    const main = document.getElementById('main-content');
    if (main) {
      main.classList.toggle('bg-dark', dark);
      main.classList.toggle('text-white', dark);
      main.classList.toggle('bg-light', !dark);
      main.classList.toggle('text-dark', !dark);
    }

    // Navbar
    const navbar = document.getElementById('main-navbar');
    if (navbar) {
      navbar.classList.toggle('navbar-custom-dark', dark);
      navbar.classList.toggle('navbar-custom-light', !dark);
    }

    // Cambia el icono y color del botón de tema
    const themeBtn = document.getElementById('toggle-theme');
    if (themeBtn) {
      const icon = themeBtn.querySelector('i');
      if (icon) {
        icon.classList.toggle('fa-moon', !dark);
        icon.classList.toggle('fa-sun', dark);
      }
      themeBtn.classList.toggle('btn-theme-dark', dark);
      themeBtn.classList.toggle('btn-theme-light', !dark);
    }

    // Cambia los dropdowns
    document.querySelectorAll('.dropdown-menu').forEach(menu => {
      menu.classList.toggle('bg-dark', dark);
      menu.classList.toggle('bg-light', !dark);
      menu.classList.toggle('text-white', dark);
      menu.classList.toggle('text-dark', !dark);
    });

    localStorage.setItem('darkTheme', dark ? '1' : '0');
  }

  document.addEventListener('DOMContentLoaded', function() {
    const dark = localStorage.getItem('darkTheme') === '1';
    setTheme(dark);
    const themeBtn = document.getElementById('toggle-theme');
    if (themeBtn) {
      themeBtn.onclick = function() {
        setTheme(!document.body.classList.contains('bg-dark'));
      }
    }
  });

  // Notificaciones
  const notifBtn = document.getElementById("enable-notifications");
  if (notifBtn) {
    if ("Notification" in window && Notification.permission === "default") {
      notifBtn.style.display = "inline-block";
    }
    notifBtn.onclick = async function() {
      const permission = await Notification.requestPermission();
      if (permission === "granted") {
        alert("¡Notificaciones habilitadas!");
        notifBtn.style.display = "none";
      } else {
        alert("No se pudieron habilitar las notificaciones.");
      }
    }
  }
  // Estado conexión
  function updateConnectionStatus() {
    const statusElement = document.getElementById("pwa-status");
    if (statusElement) {
      if (navigator.onLine) {
        statusElement.textContent = "{{ _('Conectado') }}";
        statusElement.className = "badge bg-success";
      } else {
        statusElement.textContent = "{{ _('Sin conexión') }}";
        statusElement.className = "badge bg-warning";
      }
    }
  }
  window.addEventListener("online", updateConnectionStatus);
  window.addEventListener("offline", updateConnectionStatus);
  updateConnectionStatus();
</script>
</body>
</html>