<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% if current_restaurante %}{{ current_restaurante.nombre }} - {% endif %}Resto App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#f3b927">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon-192.png') }}">
    <script src="https://kit.fontawesome.com/4c7c8e0e6e.js" crossorigin="anonymous"></script>
<style>
  body.bg-dark {
    background-color: #181818 !important;
    color: #f8f9fa !important;
  }
  .navbar-dark .navbar-nav .nav-link,
  .navbar-dark .navbar-brand,
  .navbar-dark .dropdown-toggle,
  .navbar-dark .btn-outline-light {
    color: #fff !important;
  }
  .navbar-light .navbar-nav .nav-link,
  .navbar-light .navbar-brand,
  .navbar-light .dropdown-toggle,
  .navbar-light .btn-outline-dark {
    color: #212529 !important;
  }
  .dropdown-menu {
    background-color: inherit;
  }
  .dropdown-menu .dropdown-item {
    color: inherit;
  }
  .btn-outline-light, .btn-outline-dark {
    border-color: transparent;
  }
</style>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="{{ url_for('index_redirect') }}">
      {% if current_restaurante %}{{ current_restaurante.nombre }}{% else %}Resto App{% endif %}
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarMain">
      {% if current_user.is_authenticated %}
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('index_redirect') }}">Mozo</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('cocina') }}">Cocina</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('historial') }}">Historial</a></li>
        {% if current_user.es_superadmin %}
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('auth.admin_usuarios') }}">
            <i class="fas fa-users"></i> Panel de Usuarios
          </a>
        </li>
        {% endif %}
      </ul>
      <span class="badge bg-info me-3">Plan {{ current_restaurante.plan|title }}</span>
      <div class="d-flex align-items-center gap-2">
        <span id="pwa-status" class="badge bg-secondary">Conectado</span>
        <button id="enable-notifications" class="btn btn-outline-warning btn-sm" style="display:none;">
          <i class="fas fa-bell"></i>
        </button>
        <button id="toggle-theme" class="btn btn-outline-light btn-sm" title="Cambiar tema">
          <i class="fas fa-moon"></i>
        </button>
        <div class="dropdown">
          <button class="btn btn-outline-light dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
            <i class="fas fa-user"></i> {{ current_user.nombre }}
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{{ url_for('auth.perfil') }}">Mi Perfil</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Cerrar Sesión</a></li>
          </ul>
        </div>
      </div>
      {% else %}
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a href="{{ url_for('auth.login') }}" class="btn btn-outline-light me-2">Iniciar Sesión</a></li>
        <li class="nav-item"><a href="{{ url_for('auth.registro') }}" class="btn btn-light">Registrarse</a></li>
      </ul>
      {% endif %}
    </div>
  </div>
</nav>
<main class="container my-3">
  {% block content %}{% endblock %}
</main>
<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Tema oscuro/claro
  function setTheme(dark) {
    document.body.classList.toggle('bg-dark', dark);
    document.body.classList.toggle('text-white', dark);
    const navbar = document.querySelector('.navbar');
    if (navbar) {
      navbar.classList.toggle('navbar-dark', dark);
      navbar.classList.toggle('navbar-light', !dark);
      navbar.classList.toggle('bg-dark', dark);
      navbar.classList.toggle('bg-light', !dark);
    }
    // Cambia el icono del botón
    const themeBtn = document.getElementById('toggle-theme');
    if (themeBtn) {
      const icon = themeBtn.querySelector('i');
      if (icon) {
        icon.classList.toggle('fa-moon', !dark);
        icon.classList.toggle('fa-sun', dark);
      }
      // Cambia el color del botón para que siempre sea visible
      themeBtn.classList.toggle('btn-outline-light', !dark);
      themeBtn.classList.toggle('btn-outline-dark', dark);
    }
    // Cambia los dropdowns
    document.querySelectorAll('.dropdown-menu').forEach(menu => {
      menu.classList.toggle('bg-dark', dark);
      menu.classList.toggle('bg-light', !dark);
      menu.classList.toggle('text-white', dark);
      menu.classList.toggle('text-dark', !dark);
    });
    // Guarda preferencia
    localStorage.setItem('darkTheme', dark ? '1' : '0');
  }

  // Inicializa el tema según preferencia guardada
  document.addEventListener('DOMContentLoaded', function() {
    const dark = localStorage.getItem('darkTheme') === '1';
    setTheme(dark);
    const themeBtn = document.getElementById('toggle-theme');
    if (themeBtn) {
      themeBtn.onclick = function() {
        setTheme(!document.body.classList.contains('bg-dark'));
      }
    }
  });

  // Notificaciones
  const notifBtn = document.getElementById("enable-notifications");
  if (notifBtn) {
    if ("Notification" in window && Notification.permission === "default") {
      notifBtn.style.display = "inline-block";
    }
    notifBtn.onclick = async function() {
      const permission = await Notification.requestPermission();
      if (permission === "granted") {
        alert("¡Notificaciones habilitadas!");
        notifBtn.style.display = "none";
      } else {
        alert("No se pudieron habilitar las notificaciones.");
      }
    }
  }
  // Estado conexión
  function updateConnectionStatus() {
    const statusElement = document.getElementById("pwa-status");
    if (navigator.onLine) {
      statusElement.textContent = "Conectado";
      statusElement.className = "badge bg-success";
    } else {
      statusElement.textContent = "Sin conexión";
      statusElement.className = "badge bg-warning";
    }
  }
  window.addEventListener("online", updateConnectionStatus);
  window.addEventListener("offline", updateConnectionStatus);
  updateConnectionStatus();
</script>
</body>
</html>